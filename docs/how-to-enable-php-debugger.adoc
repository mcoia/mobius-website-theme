# Enable PHP Debugging w/ Xdebug
----

*This assumes your running some version of Ubuntu & using PHPStorm*

The ip of the machine I set this up on was 192.168.11.171

Just a forewarning... I'm not 100% this is all correct.
I will try and keep this doc updated if I make any changes to my dev env.

Start by installing xdebug
[source]

----
sudo apt install php-xdebug php-xdebug-all-dev
----

Next we'll modify our php.ini file to enable xdebug.

----
/etc/php/8.1/apache2/php.ini
----

Add this to the bottom of the file.

----
[xdebug]
zend_extension="9003"
xdebug.mode=debug
xdebug.client_host=127.0.0.1
xdebug.client_port="9003";
----

Now we'll check to make sure we're all good by editing our index.php file temporarily adding phpinfo();

image::{docdir}/img/xdebug-setup/image-2022-06-30-10-03-04-541.png[]

Now goto your index.php url and you should get the phpinfo readout.
Scroll down to the XDEBUG section.

image::{docdir}/img/xdebug-setup/image-2022-06-30-10-10-14-338.png[]

You should get something like this...

Make sure this is correct *IDE Key: PHPSTORM*

We Need to add the server settings in PHPStorm.
This may be required before the ide key will show up.

image::{docdir}/img/xdebug-setup/image-2022-06-30-10-12-23-453.png[]

We also need to setup the PHP CLI portion

image::{docdir}/img/xdebug-setup/image-2022-06-30-10-17-25-810.png[]

We also need to add the firefox debugger extention.

image::{docdir}/img/xdebug-setup/image-2022-06-30-10-14-30-451.png[]

You will get a little icon in your address bar.

image::{docdir}/img/xdebug-setup/image-2022-06-30-10-15-09-144.png[]

image::{docdir}/img/xdebug-setup/image-2022-06-30-10-15-50-819.png[]

Hopefully it all works!
ðŸ¤“

And for god sakes, clear your caches!

----
drush cr
----

Be sure to remove the phpinfo(); & exit(); method calls from your index.php file.

If it's still not working I have failed you.
you may need to set the xdebug env variable.
----
export XDEBUG_SESSION=1
----

You can consult these links.
https://www.jetbrains.com/help/phpstorm/configuring-xdebug.html

https://dev.acquia.com/article/debugging-twig-templates-drupal-8-phpstorm-and-xdebug

Some added information for drupal stuff.
You have to set drupal for debugging mode.
And.... you need to enable cacheing for twig templates.

~/drupal/web/sites/development.services.yml

image::{docdir}/img/xdebug-setup/image-2022-06-30-10-23-22-529.png[]

In case the site info goes away... The debugging link on the site is 404 so...

image::{docdir}/img/xdebug-setup/Screenshot 2022-06-30 at 10-44-46 Debugging TWIG templates in Drupal 8 with PhpStorm and XDebug.png[]

Here is a drupal module that looks interesting. I have not used it yet.
https://www.drupal.org/project/twig_xdebug
